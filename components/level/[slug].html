<!-- components/level/[slug].html -->
<section class="level-detail" role="region" aria-label="Level detail page">
    <!-- Header（JS 注入） -->
    <div id="header-container"></div>
  
    <main id="main-content" role="main" class="page-shell">
      <div class="container">
        <!-- 面包屑/返回 -->
        <nav aria-label="Breadcrumb">
          <a href="/levels.html" class="back-button" itemprop="item">
            <i class="fas fa-arrow-left" aria-hidden="true"></i>
            <span style="margin-left: 8px;">Back to Level List</span>
          </a>
        </nav>
  
        <!-- 标题 + 直达关卡 -->
        <header class="level-header">
          <h1>Level {{ slug }} · Hole People</h1>
          <p>Complete video walkthrough and step-by-step strategy for Level {{ slug }}.</p>
  
          <div class="level-jump" role="search" aria-label="Go to specific level">
            <label for="lv-input">Go to level</label>
            <div class="jump-box">
              <input id="lv-input" type="number" min="1" max="639" placeholder="1-639" inputmode="numeric" />
              <button id="lv-go" class="go-btn">
                <i class="fas fa-location-arrow" aria-hidden="true"></i>
                Go
              </button>
            </div>
          </div>
        </header>
  
        <!-- 主体 -->
        <div class="level-content">
          <div class="level-info">
            <!-- 左：视频 + 推荐 -->
            <article class="video-guide" aria-labelledby="video-title">
              <h2 id="video-title">Level {{ slug }} Walkthrough Video</h2>
              <iframe
                id="lv-yt"
                title="Hole People Level {{ slug }} Walkthrough"
                loading="lazy"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen
              ></iframe>
  
              <nav class="video-navigation" aria-label="Level navigation">
                <a id="btn-prev" class="prev-button" rel="prev"><i class="fas fa-arrow-left" aria-hidden="true"></i>&nbsp;Previous Level</a>
                <a id="btn-next" class="next-button" rel="next">Next Level&nbsp;<i class="fas fa-arrow-right" aria-hidden="true"></i></a>
              </nav>
  
              <!-- 推荐关卡（固定 2 行 × 4 列） -->
              <section class="recommended-levels below-video" aria-labelledby="rec-title">
                <h2 id="rec-title">Recommended Levels</h2>
                <div id="rec-cards" class="recommended-cards"></div>
              </section>
            </article>
  
            <!-- 右：说明 -->
            <aside class="text-guide" aria-labelledby="guide-title">
              <h2 id="guide-title">Step-by-Step Walkthrough</h2>
  
              <p><strong>Stuck on a Hole People level?</strong> Don't worry. Our Level Walkthroughs give you thousands of up-to-date solutions so you can clear every stage with confidence. Each walkthrough pairs a <em>video guide</em> that shows the exact solution with a concise, <em>step-by-step</em> write-up you can follow move by move.</p>
  
              <h3>What's Included in Each Walkthrough</h3>
              <ul>
                <li><strong>Video Guide:</strong> Watch a real gameplay solution and see exactly how the level is solved.</li>
                <li><strong>Step-by-Step Instructions:</strong> Follow clear written steps to reproduce the moves effortlessly.</li>
                <li><strong>Smart Strategies:</strong> Learn proven tricks to unblock paths and finish faster.</li>
                <li><strong>Beat Any Level:</strong> Find reliable solutions for even the toughest stages.</li>
              </ul>
  
              <h3>How to Use These Guides</h3>
              <ul>
                <li><strong>Find Your Level:</strong> Use search or the list to locate the exact stage you’re stuck on.</li>
                <li><strong>Watch the Video:</strong> Play the walkthrough to see a visual, step-by-step solution.</li>
                <li><strong>Follow the Steps:</strong> Read the text guide while you apply the same strategy in game.</li>
                <li><strong>Pause & Replay:</strong> Missed a move? Pause or rewind until everything clicks.</li>
                <li><strong>Apply & Win:</strong> Use the insights to clear the level and keep progressing!</li>
              </ul>
  
              <p><strong>Still stuck?</strong> Our walkthroughs include video, step-by-step moves, and pro tips to get you unstuck fast.</p>
            </aside>
          </div>
  
          <!-- 在线游戏 -->
          <section class="game-ad" aria-labelledby="play-title">
            <h2 id="play-title" class="game-title">Play Now</h2>
            <iframe 
              src="components/levels-ad.html" 
              loading="lazy"
              scrolling="no"
              sandbox="allow-scripts allow-same-origin allow-popups">
            </iframe>
          </section>
        </div>
      </div>
    </main>
  
    <!-- Footer 挂载点 -->
    <div id="footer-container"></div>
  </section>
  
  <style>
    :root{
      --primary:#6C63FF;--primary-light:#8580FF;--accent:#36D1DC;
      --light-bg:#f8f9fe;--card-bg:#fff;--text-dark:#2d2b4e;--text-light:#5a5779;
      --border-light:#e4e6f0;--gradient-primary:linear-gradient(135deg,var(--primary),var(--accent));
      --shadow:0 10px 30px rgba(108,99,255,.15);--shadow-hover:0 15px 35px rgba(108,99,255,.25);
      --radius:12px;--transition:all .3s ease; --container:1280px;
    }
    .page-shell{width:92%;max-width:var(--container);margin:0 auto}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Poppins',sans-serif;background:var(--light-bg);color:var(--text-light);line-height:1.6;overflow-x:hidden}
  
    .level-detail{width:100%}
    .container{background:var(--card-bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:2rem;position:relative;overflow:hidden;animation:fadeIn .6s ease-out}
    .container::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:var(--gradient-primary)}
  
    .back-button{display:inline-flex;align-items:center;color:var(--primary);text-decoration:none;font-weight:600;margin-bottom:1.2rem;transition:var(--transition);padding:.5rem 1rem;border-radius:6px;background:rgba(108,99,255,.1)}
    .back-button:hover{color:var(--accent);background:rgba(108,99,255,.18);transform:translateX(-4px)}
  
    .level-header h1{font-family:'Oxanium',cursive;color:var(--text-dark);font-size:2.2rem;margin:0 0 .4rem;background:var(--gradient-primary);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .level-header p{color:var(--text-light);font-size:1.06rem;margin-bottom:1.1rem}
  
    .level-jump{display:flex;align-items:center;gap:.75rem;margin:.3rem 0 1.2rem;flex-wrap:wrap}
    .jump-box{display:flex;align-items:center;gap:.5rem;background:#fff;border:1px solid var(--border-light);box-shadow:var(--shadow);border-radius:999px;padding:.35rem .4rem}
    #lv-input{width:120px;border:0;outline:none;padding:.55rem .75rem;border-radius:999px;background:transparent;font-weight:700;color:var(--text-dark)}
  
    .level-info{display:grid;grid-template-columns:1.35fr 1fr;gap:1.25rem;align-items:stretch}
    @media(max-width:1024px){.level-info{grid-template-columns:1fr;align-items:start}}
  
    .video-guide,.text-guide{background:var(--light-bg);border-radius:var(--radius);padding:1.5rem;box-shadow:var(--shadow);transition:var(--transition);display:flex;flex-direction:column;height:100%}
    .video-guide h2,.text-guide h2{font-family:'Oxanium',cursive;color:var(--text-dark);margin-bottom:1rem;font-size:1.28rem}
    .text-guide h3,
    .text-guide strong {color: var(--primary);}   /* 小节/强调为蓝色 */
    .text-guide p strong {color: var(--primary);}
    #lv-yt{width:100%;aspect-ratio:16/9;border:0;border-radius:12px;background:#eee;margin-bottom:1rem}
     
    #lv-go {
          display:inline-flex;
          align-items:center;
          justify-content:center;
          padding:.75rem 1.25rem;
          background:var(--primary);
          color:#fff;
          text-decoration:none;
          border-radius:10px;
          font-weight:700;
          transition:var(--transition);
          border:0;
          cursor:pointer;
        }

        #lv-go:hover {
          background:var(--primary-light);
          transform:translateY(-2px);
        }
    .video-navigation{display:flex;justify-content:space-between;margin-top:1rem}
    .prev-button,.next-button{display:inline-flex;align-items:center;padding:.75rem 1.25rem;background:var(--primary);color:#fff;text-decoration:none;border-radius:10px;font-weight:700;transition:var(--transition)}
    .prev-button{background:#5a5779}.prev-button:hover{background:#2d2b4e}
    .next-button:hover{background:var(--primary-light);transform:translateY(-2px)}
  
    /* 推荐关卡：固定 2 行 × 4 列，统一高度，视觉整齐 */
    .recommended-levels{background:var(--light-bg);border-radius:var(--radius);padding:1.25rem;box-shadow:var(--shadow);margin-top:1rem;margin-bottom:0}
    .recommended-levels h2{font-family:'Oxanium',cursive;color:var(--text-dark);margin-bottom:.75rem;font-size:1.2rem;text-align:center;position:relative;padding-bottom:.35rem}
    .recommended-levels h2::after{content:'';position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:60px;height:3px;background:var(--gradient-primary);border-radius:2px}
    .recommended-cards{display:grid;grid-template-columns:repeat(4,1fr);grid-template-rows:repeat(2,1fr);gap:.85rem}
    .recommended-card{background:#fff;border-radius:12px;padding:.75rem;box-shadow:var(--shadow);border:1px solid var(--border-light);text-align:center;transition:var(--transition);display:flex;flex-direction:column;align-items:center;justify-content:space-between}
    .recommended-card .level-number{font-family:'Oxanium',cursive;font-weight:800;font-size:1.2rem;color:var(--primary);margin-bottom:.25rem}
    .watch-btn{display:inline-flex;align-items:center;justify-content:center;padding:.5rem 1rem;background:var(--primary);color:#fff;text-decoration:none;border-radius:30px;font-weight:700;transition:var(--transition);width:100%;max-width:140px}
    .watch-btn:hover{background:var(--primary-light);transform:translateY(-2px)}
  
    .game-ad{background:linear-gradient(135deg,var(--primary),var(--accent));border-radius:var(--radius);padding:2rem;box-shadow:var(--shadow);text-align:center;margin-top:2rem;color:#fff}
    .game-title{font-family:'Oxanium',cursive;font-size:2rem;font-weight:700;margin-bottom:.5rem}
    .game-ad iframe{display:block;width:100%;height:800px;border:0;border-radius:var(--radius);box-shadow:var(--shadow-hover)}
    @media(max-width:768px){.game-ad iframe{height:420px}}
  
    #footer-container{margin:0!important;padding:0!important}
    #footer-container *:last-child{margin-bottom:0!important}
  
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
  </style>
  
  <script>
  (function () {
    const slug = parseInt('{{ slug }}', 10);
  
    // 头部注入（若已有则不重复）
    const smartInject = (id, url) => {
      const host = document.getElementById(id);
      if (!host || host.children.length > 0 || (host.textContent||'').trim()) return;
      fetch(url).then(r => r.text()).then(html => host.innerHTML = html).catch(()=>{});
    };
    smartInject('header-container','components/header.html');
  
    // 精确加载 videoId
    const yt = document.getElementById('lv-yt');
    const MAP_URL = '/data/level-videos.json';
    function buildYtEmbed(id){return `https://www.youtube-nocookie.com/embed/${id}?autoplay=0&rel=0&modestbranding=1&playsinline=1&enablejsapi=1`}
    function fallbackSearch(n){const q=encodeURIComponent(`Hole People Level ${n} walkthrough`);return `https://www.youtube.com/embed?autoplay=0&listType=search&list=${q}`}
  
    // 预连提升首帧
    const pre = document.createElement('link');
    pre.rel = 'preconnect';
    pre.href = 'https://www.youtube-nocookie.com';
    document.head.appendChild(pre);
  
    async function injectStructuredData({videoId}) {
      // VideoObject
      const sd = {
        "@context": "https://schema.org",
        "@type": "VideoObject",
        "name": `Hole People Level ${slug} Walkthrough`,
        "description": `Complete walkthrough video and step-by-step strategy for Hole People Level ${slug}.`,
        "thumbnailUrl": [`https://i.ytimg.com/vi/${videoId}/hqdefault.jpg`],
        "embedUrl": `https://www.youtube-nocookie.com/embed/${videoId}`,
        "url": location.href
      };
      const tag = document.createElement('script');
      tag.type = 'application/ld+json';
      tag.text = JSON.stringify(sd);
      document.head.appendChild(tag);
  
      // BreadcrumbList
      const crumbs = {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {"@type":"ListItem","position":1,"name":"Home","item":`${location.origin}/`},
          {"@type":"ListItem","position":2,"name":"Level Guides","item":`${location.origin}/levels.html`},
          {"@type":"ListItem","position":3,"name":`Level ${slug}`}
        ]
      };
      const bc = document.createElement('script');
      bc.type = 'application/ld+json';
      bc.text = JSON.stringify(crumbs);
      document.head.appendChild(bc);
    }
  
    async function applyVideo(n){
      if(!yt) return;
      try{
        const res = await fetch(MAP_URL,{cache:'no-store'});
        const map = await res.json();
        const id = map[String(n)] || map[n];
  
        if (id) {
          yt.src = buildYtEmbed(id);
          // 注入 <link rel="prev/next">（利于SEO发现分页）
          const clamp = x => Math.min(639, Math.max(1, x));
          const prevHref = `levels.html?n=${clamp(n-1)}`;
          const nextHref = `levels.html?n=${clamp(n+1)}`;
          const linkPrev = Object.assign(document.createElement('link'), { rel:'prev', href: prevHref });
          const linkNext = Object.assign(document.createElement('link'), { rel:'next', href: nextHref });
          document.head.appendChild(linkPrev); document.head.appendChild(linkNext);
  
          // 结构化数据
          injectStructuredData({videoId:id});
        } else {
          yt.src = fallbackSearch(n);
        }
      } catch {
        yt.src = fallbackSearch(n);
      }
    }
    applyVideo(slug);
  
    // 上/下一关
    const clamp = n => Math.min(639, Math.max(1, n));
    const prev = document.getElementById('btn-prev');
    const next = document.getElementById('btn-next');
    if(prev) prev.href = `/level.html?n=${clamp(slug - 1)}`;
    if(next) next.href = `/level.html?n=${clamp(slug + 1)}`;
  
    // 推荐关卡：围绕当前 ±1~±4，去重、裁边界、排除当前；固定最多 8 个
    const candidates = [-4,-3,-2,-1,1,2,3,4].map(d => clamp(slug + d));
    const picks = [...new Set(candidates.filter(n => n !== slug))].slice(0, 8);
    const recHost = document.getElementById('rec-cards');
    if (recHost) {
      recHost.innerHTML = picks.map(n => `
        <article class="recommended-card">
          <span class="level-number">Level ${n}</span>
          <span class="guide-type">Video Guide</span>
          <a class="watch-btn" href="levels.html?n=${n}">
            <i class="fas fa-play-circle" aria-hidden="true"></i> Watch Now
          </a>
        </article>
      `).join('');
    }
  
    // Go to level
    const input = document.getElementById('lv-input');
    const goBtn = document.getElementById('lv-go');
    const go = () => {
      const n = clamp(parseInt(input.value, 10));
      if (!isNaN(n)) location.href = `/level.html?n=${n}`;
    };
    if (goBtn) goBtn.addEventListener('click', go);
    if (input) input.addEventListener('keydown', e => { if (e.key === 'Enter') go(); });
  })();
  </script>
  
